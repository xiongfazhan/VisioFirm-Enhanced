{% extends "labeler_base.html" %}
{% block title %}数据集管理{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/datasets.css') }}">
{% endblock %}

{% block content %}
    <div class="dataset-container">
        <!-- Header -->
        <div class="dataset-header">
            <h1 class="dataset-title">数据集管理</h1>
            <div class="dataset-actions">
                <button class="btn btn-secondary">
                    <span>📥</span> 下载数据集
                </button>
                <button class="btn btn-primary">
                    <span>➕</span> 创建数据集
                </button>
            </div>
        </div>
        
        <!-- Controls -->
        <div class="dataset-controls">
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" 
                       placeholder="搜索数据集名称或描述...">
                <button class="search-btn">🔍</button>
            </div>
            <select class="filter-select" id="typeFilter">
                <option value="">所有类型</option>
                <option value="custom">自定义</option>
                <option value="downloaded">下载</option>
                <option value="imported">导入</option>
            </select>
        </div>
        
        <!-- Dataset Grid -->
        <div id="datasetGrid" class="dataset-grid">
            <div class="loading">正在加载数据集...</div>
        </div>
        
        <!-- Pagination -->
        <div id="pagination" class="pagination" style="display: none;">
            <!-- Pagination will be populated by JavaScript -->
        </div>
    </div>
    
    <!-- Download Modal -->
    <div id="downloadModal" class="modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h2 class="modal-title">下载开源数据集</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 下载方式选择 -->
                <div class="download-tabs">
                    <button class="tab-btn active">手动输入</button>
                    <button class="tab-btn">搜索数据集</button>
                    <button class="tab-btn">热门数据集</button>
                </div>
                
                <!-- 手动输入方式 -->
                <div id="manualTab" class="download-tab-content active">
                <form class="download-form" onsubmit="startDownload(event)">
                    <div class="form-group">
                        <label class="form-label">数据集URL *</label>
                        <input type="url" class="form-input" id="downloadUrl" 
                               placeholder="https://example.com/dataset.zip" required>
                            <small class="form-hint">支持 .zip, .tar, .tar.gz, .rar 格式</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">数据集名称 *</label>
                        <input type="text" class="form-input" id="downloadName" 
                               placeholder="输入数据集名称" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">描述</label>
                        <textarea class="form-input form-textarea" id="downloadDescription" 
                                  placeholder="数据集描述（可选）"></textarea>
                    </div>
                    </form>
                </div>
                
                <!-- 搜索方式 -->
                <div id="searchTab" class="download-tab-content">
                    <div class="search-section">
                        <div class="search-box">
                            <input type="text" class="search-input" id="datasetSearch" 
                                   placeholder="搜索数据集名称或关键词...">
                            <button class="search-btn">🔍</button>
                        </div>
                        <select class="filter-select" id="sourceFilter">
                            <option value="all">所有来源</option>
                            <option value="kaggle">Kaggle</option>
                            <option value="github">GitHub</option>
                            <option value="huggingface">HuggingFace</option>
                        </select>
                    </div>
                    <div id="searchResults" class="search-results">
                        <!-- 搜索结果将在这里显示 -->
                    </div>
                </div>
                
                <!-- 热门数据集 -->
                <div id="popularTab" class="download-tab-content">
                    <div class="popular-datasets">
                        <div class="dataset-card">
                            <h4>COCO数据集</h4>
                            <p>Microsoft Common Objects in Context</p>
                            <span class="dataset-size">~18GB</span>
                        </div>
                        <div class="dataset-card">
                            <h4>ImageNet</h4>
                            <p>大规模图像分类数据集</p>
                            <span class="dataset-size">~150GB</span>
                        </div>
                        <div class="dataset-card">
                            <h4>Pascal VOC</h4>
                            <p>Pascal Visual Object Classes</p>
                            <span class="dataset-size">~2GB</span>
                        </div>
                        <div class="dataset-card">
                            <h4>Open Images</h4>
                            <p>Google开源图像数据集</p>
                            <span class="dataset-size">~500GB</span>
                        </div>
                    </div>
                </div>
                
                <!-- 下载进度 -->
                <div class="progress-container" id="progressContainer" style="display: none;">
                    <div class="progress-header">
                        <span id="progressTitle">下载进度</span>
                        <button class="cancel-btn" id="cancelBtn">取消下载</button>
                    </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    <div class="progress-details">
                        <div class="progress-text" id="progressText">准备下载...</div>
                        <div class="progress-stats" id="progressStats"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary">取消</button>
                <button type="button" class="btn btn-primary" id="downloadBtn">开始下载</button>
            </div>
        </div>
    </div>
    
    <!-- Dataset Detail Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="detailTitle">数据集详情</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="detailBody">
                <!-- Detail content will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary">关闭</button>
                <button type="button" class="btn btn-primary" id="linkProjectBtn">关联项目</button>
            </div>
        </div>
    </div>

{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/datasetManager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/datasetDownloader.js') }}"></script>
<script src="{{ url_for('static', filename='js/datasets.js') }}"></script>
{% endblock %}
