{% extends "labeler_base.html" %}
{% block title %}{{ project_name }} - 模型训练{% endblock %}
{% block content %}
<style>
    .training-dashboard {
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
    }
    
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #e0e0e0;
    }
    
    .project-info {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    
    .project-title {
        font-size: 28px;
        font-weight: bold;
        color: #333;
    }
    
    .project-stats {
        display: flex;
        gap: 20px;
        color: #666;
        font-size: 14px;
    }
    
    .stat-item {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .create-task-btn {
        background: linear-gradient(45deg, #007bff, #00c4ff);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .create-task-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
    }
    
    .dashboard-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
    }
    
    .section {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .section-title {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 20px;
        color: #333;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .task-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
    }
    
    .task-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }
    
    .task-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .task-name {
        font-weight: bold;
        font-size: 16px;
        color: #333;
    }
    
    .task-status {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
    }
    
    .status-pending {
        background: #fff3cd;
        color: #856404;
    }
    
    .status-running {
        background: #d1ecf1;
        color: #0c5460;
    }
    
    .status-completed {
        background: #d4edda;
        color: #155724;
    }
    
    .status-failed {
        background: #f8d7da;
        color: #721c24;
    }
    
    .status-stopped {
        background: #e2e3e5;
        color: #383d41;
    }
    
    .task-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 10px;
        font-size: 14px;
        color: #666;
    }
    
    .progress-bar {
        width: 100%;
        height: 8px;
        background: #e0e0e0;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 10px;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(45deg, #007bff, #00c4ff);
        transition: width 0.3s ease;
    }
    
    .task-actions {
        display: flex;
        gap: 10px;
    }
    
    .btn {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .btn-primary {
        background: #007bff;
        color: white;
    }
    
    .btn-danger {
        background: #dc3545;
        color: white;
    }
    
    .btn-success {
        background: #28a745;
        color: white;
    }
    
    .btn-secondary {
        background: #6c757d;
        color: white;
    }
    
    .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    
    .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px;
        color: #666;
    }
    
    .empty-state i {
        font-size: 48px;
        margin-bottom: 20px;
        color: #ccc;
    }
    
    /* 模态框样式 */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }
    
    .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 0;
        border-radius: 12px;
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
    }
    
    .modal-header {
        padding: 20px;
        border-bottom: 1px solid #e0e0e0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-title {
        font-size: 24px;
        font-weight: bold;
        color: #333;
    }
    
    .close-btn {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #666;
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
    }
    
    .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }
    
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }
    
    .form-row-3 {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 15px;
    }
    
    .modal-footer {
        padding: 20px;
        border-top: 1px solid #e0e0e0;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }
    
    .btn-large {
        padding: 12px 24px;
        font-size: 16px;
    }
    
    .help-text {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
    }
    
    .alert {
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 20px;
    }
    
    .alert-warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
    }
    
    .alert-info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
    }
    
    /* 进度条动画 */
    @keyframes progressPulse {
        0% { opacity: 0.6; }
        50% { opacity: 1; }
        100% { opacity: 0.6; }
    }
    
    .progress-fill.running {
        animation: progressPulse 2s infinite;
    }
    
    /* 状态指示灯 */
    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
        animation: none;
    }
    
    .status-running .status-indicator {
        background: #17a2b8;
        animation: pulse 1.5s infinite;
    }
    
    .status-completed .status-indicator {
        background: #28a745;
    }
    
    .status-failed .status-indicator {
        background: #dc3545;
    }
    
    .status-pending .status-indicator {
        background: #ffc107;
    }
    
    .status-stopped .status-indicator {
        background: #6c757d;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.2); opacity: 0.7; }
        100% { transform: scale(1); opacity: 1; }
    }
    
    /* 任务卡片改进 */
    .task-card {
        position: relative;
        overflow: hidden;
    }
    
    .task-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        transition: left 0.5s;
    }
    
    .task-card:hover::before {
        left: 100%;
    }
    
    /* 表单改进 */
    .form-control {
        transition: all 0.3s ease;
        border: 2px solid #ddd;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        transform: translateY(-1px);
    }
    
    .form-control.valid {
        border-color: #28a745;
    }
    
    .form-control.invalid {
        border-color: #dc3545;
    }
    
    /* 加载状态改进 */
    .loading-dots {
        display: inline-block;
    }
    
    .loading-dots::after {
        content: '';
        animation: loadingDots 1.5s infinite;
    }
    
    @keyframes loadingDots {
        0%, 20% { content: '.'; }
        40% { content: '..'; }
        60%, 100% { content: '...'; }
    }
    
    /* 数据统计卡片 */
    .stats-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        text-align: center;
    }
    
    .stats-value {
        font-size: 32px;
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .stats-label {
        font-size: 14px;
        opacity: 0.9;
    }
    
    /* 响应式设计改进 */
    @media (max-width: 768px) {
        .dashboard-content {
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .form-row {
            grid-template-columns: 1fr;
        }
        
        .form-row-3 {
            grid-template-columns: 1fr;
        }
        
        .task-actions {
            flex-direction: column;
            gap: 5px;
        }
        
        .btn {
            width: 100%;
        }
    }
    
    /* 验证结果样式 */
    .validation-results {
        padding: 20px;
    }
    
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .metric-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .metric-label {
        font-size: 14px;
        opacity: 0.9;
        margin-bottom: 8px;
    }
    
    .metric-value {
        font-size: 24px;
        font-weight: bold;
    }
    
    .class-metrics {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        max-height: 300px;
        overflow-y: auto;
    }
    
    .class-metric-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .class-metric-item:last-child {
        border-bottom: none;
    }
    
    .class-name {
        font-weight: bold;
        color: #333;
    }
    
    .class-ap {
        color: #666;
        font-size: 14px;
    }
    
    /* 导出对话框样式 */
    .export-dialog {
        min-width: 500px;
    }
    
    .checkbox-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .checkbox-group label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: normal;
        cursor: pointer;
    }
    
    .checkbox-group input[type="checkbox"] {
        margin: 0;
    }
    
    /* 进度监控样式 */
    .progress-monitor {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .progress-info {
        margin-bottom: 20px;
    }
    
    .progress-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
    }
    
    .progress-stats .stat-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .stat-label {
        font-weight: bold;
        color: #666;
    }
    
    .progress-charts {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
    }
    
    .chart-container {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        min-height: 300px;
    }
    
    .chart-title {
        font-weight: bold;
        margin-bottom: 15px;
        text-align: center;
        color: #333;
    }
    
    /* 实时状态指示 */
    .live-indicator {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        font-size: 12px;
        color: #28a745;
    }
    
    .live-dot {
        width: 8px;
        height: 8px;
        background: #28a745;
        border-radius: 50%;
        animation: livePulse 2s infinite;
    }
    
    @keyframes livePulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.3; }
    }
    
    /* 资源监控样式 */
    .resource-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .resource-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 8px;
        text-align: center;
    }
    
    .resource-item label {
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
    }
    
    .usage-normal { color: #28a745; }
    .usage-medium { color: #ffc107; }
    .usage-high { color: #fd7e14; }
    .usage-critical { color: #dc3545; }
    
    .gpu-container {
        margin-top: 15px;
    }
    
    .gpu-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background: #e9ecef;
        border-radius: 6px;
        margin-bottom: 10px;
    }
    
    .gpu-name {
        font-weight: bold;
        font-size: 14px;
    }
    
    .gpu-memory {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .gpu-memory-detail {
        font-size: 12px;
        color: #666;
    }
    
    .warnings-container {
        margin-top: 15px;
    }
    
    .warning-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 6px;
        margin-bottom: 8px;
        font-size: 14px;
        color: #856404;
    }
    
    /* 性能优化样式 */
    .suggestions-container {
        max-height: 400px;
        overflow-y: auto;
    }
    
    .suggestion-item {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-bottom: 15px;
        overflow: hidden;
    }
    
    .suggestion-header {
        padding: 12px 15px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: bold;
    }
    
    .suggestion-content {
        padding: 15px;
    }
    
    .config-changes {
        margin-top: 10px;
        padding: 8px 12px;
        background: #e7f3ff;
        border-left: 4px solid #007bff;
        font-size: 13px;
        font-family: monospace;
    }
    
    .apply-suggestion {
        margin: 0 15px 15px 15px;
    }
    
    .no-suggestions {
        text-align: center;
        color: #666;
        font-style: italic;
        padding: 20px;
    }
    
    .suggestion-memory .suggestion-header {
        background: #fff3cd;
        color: #856404;
    }
    
    .suggestion-cpu .suggestion-header {
        background: #f8d7da;
        color: #721c24;
    }
    
    .suggestion-gpu_memory .suggestion-header {
        background: #d1ecf1;
        color: #0c5460;
    }
    
    .card-actions {
        display: flex;
        gap: 10px;
    }
    
    .btn-sm {
        padding: 4px 8px;
        font-size: 12px;
    }
</style>

<div class="training-dashboard">
    <div class="dashboard-header">
        <div class="project-info">
            <div class="project-title">{{ project_name }} - 模型训练</div>
            <div class="project-stats">
                <div class="stat-item">
                    <i class="fas fa-tags"></i>
                    <span>{{ classes|length }} 个类别</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-images"></i>
                    <span>{{ annotated_count }} 张已标注图片</span>
                </div>
            </div>
        </div>
        <button class="create-task-btn" onclick="openCreateTaskModal()" {% if annotated_count == 0 %}disabled title="请先完成图片标注"{% endif %}>
            <i class="fas fa-plus"></i> 创建训练任务
        </button>
    </div>

    {% if annotated_count == 0 %}
    <div class="alert alert-warning">
        <i class="fas fa-exclamation-triangle"></i>
        <strong>提示：</strong>当前项目没有已标注的图片，请先完成图片标注后再创建训练任务。
        <a href="/annotation/{{ project_name }}" style="color: #856404; text-decoration: underline;">前往标注页面</a>
    </div>
    {% endif %}

    <div class="dashboard-content">
        <div class="section">
            <div class="section-title">
                <i class="fas fa-tasks"></i>
                训练任务
            </div>
            <div id="tasks-container">
                {% if tasks %}
                    {% for task in tasks %}
                    <div class="task-card" data-task-id="{{ task.id }}">
                        <div class="task-header">
                            <div class="task-name">{{ task.task_name }}</div>
                            <div class="task-status status-{{ task.status }}">
                                <span class="status-indicator"></span>
                                {{ task.status }}
                            </div>
                        </div>
                        <div class="task-details">
                            <div><strong>模型:</strong> {{ task.model_type }}</div>
                            <div><strong>创建时间:</strong> {{ task.created_at[:16] }}</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill {% if task.status == 'running' %}running{% endif %}" style="width: {{ task.progress }}%"></div>
                        </div>
                        <div class="progress-text">
                            <small>{{ task.progress }}% 完成</small>
                        </div>
                        <div class="task-actions">
                            {% if task.status == 'pending' %}
                            <button class="btn btn-primary" onclick="startTask('{{ task.id }}')">
                                <i class="fas fa-play"></i> 开始训练
                            </button>
                            {% elif task.status == 'running' %}
                            <button class="btn btn-danger" onclick="stopTask('{{ task.id }}')">
                                <i class="fas fa-stop"></i> 停止训练
                            </button>
                            {% elif task.status == 'completed' %}
                            <button class="btn btn-success" onclick="downloadModel('{{ task.id }}')">
                                <i class="fas fa-download"></i> 下载模型
                            </button>
                            <button class="btn btn-secondary" onclick="validateModel('{{ task.id }}')">
                                <i class="fas fa-check"></i> 验证模型
                            </button>
                            {% endif %}
                            <button class="btn btn-secondary" onclick="viewTaskDetails('{{ task.id }}')">
                                <i class="fas fa-eye"></i> 详情
                            </button>
                            {% if task.status != 'running' %}
                            <button class="btn btn-danger" onclick="deleteTask('{{ task.id }}')">
                                <i class="fas fa-trash"></i> 删除
                            </button>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-robot"></i>
                    <h3>还没有训练任务</h3>
                    <p>创建您的第一个训练任务来开始模型训练</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="section">
            <div class="section-title">
                <i class="fas fa-cog"></i>
                训练配置
            </div>
            <div id="configs-container">
                {% if configs %}
                    {% for config in configs %}
                    <div class="task-card">
                        <div class="task-header">
                            <div class="task-name">{{ config.config_name }}</div>
                            <div class="task-status status-pending">配置</div>
                        </div>
                        <div class="task-details">
                            <div><strong>模型:</strong> {{ config.model_type }}</div>
                            <div><strong>轮数:</strong> {{ config.epochs }}</div>
                            <div><strong>批次大小:</strong> {{ config.batch_size }}</div>
                            <div><strong>学习率:</strong> {{ config.learning_rate }}</div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-primary" onclick="useConfig('{{ config.id }}')">
                                <i class="fas fa-play"></i> 使用配置
                            </button>
                            <button class="btn btn-secondary" onclick="editConfig('{{ config.id }}')">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-sliders-h"></i>
                    <h3>还没有保存的配置</h3>
                    <p>创建训练任务时可以保存配置以便重复使用</p>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- 资源监控和性能优化面板 -->
        <div class="section">
            <div class="section-title">
                <i class="fas fa-tachometer-alt"></i>
                系统资源监控
            </div>
            <div class="task-card">
                <div class="resource-grid">
                    <div class="resource-item">
                        <label>CPU使用率:</label>
                        <span id="cpu-usage" class="usage-normal">0%</span>
                    </div>
                    <div class="resource-item">
                        <label>内存使用率:</label>
                        <span id="memory-usage" class="usage-normal">0%</span>
                    </div>
                    <div class="resource-item">
                        <label>可用内存:</label>
                        <span id="memory-available">0 GB</span>
                    </div>
                    <div class="resource-item">
                        <label>活跃任务:</label>
                        <span id="active-tasks" class="usage-normal">0/1</span>
                    </div>
                </div>
                
                <div id="gpu-info" class="gpu-container"></div>
                
                <div id="resource-warnings" class="warnings-container" style="display: none;"></div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">
                <i class="fas fa-rocket"></i>
                性能优化
                <div class="card-actions" style="margin-left: auto;">
                    <button id="optimize-performance" class="btn btn-secondary btn-sm">
                        <i class="fas fa-search"></i> 获取建议
                    </button>
                    <button id="get-optimal-config" class="btn btn-primary btn-sm">
                        <i class="fas fa-magic"></i> 优化配置
                    </button>
                </div>
            </div>
            <div class="task-card">
                <div id="performance-suggestions" class="suggestions-container">
                    <p class="no-suggestions">点击“获取建议”来分析当前配置</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 创建训练任务模态框 -->
<div id="createTaskModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">创建训练任务</div>
            <button class="close-btn" onclick="closeCreateTaskModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="createTaskForm">
                <div class="form-group">
                    <label class="form-label">任务名称 *</label>
                    <input type="text" class="form-control" id="taskName" required placeholder="输入有意义的任务名称">
                    <div class="help-text">为您的训练任务起一个描述性的名称（2-50个字符）</div>
                </div>

                <div class="form-group">
                    <label class="form-label">模型类型 *</label>
                    <select class="form-control" id="modelType" required>
                        {% for model in available_models %}
                        <option value="{{ model.name }}">{{ model.name }} - {{ model.description }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">数据集分割</label>
                    <div class="form-row-3">
                        <div>
                            <label class="form-label">训练集比例</label>
                            <input type="number" class="form-control" id="trainRatio" value="0.7" min="0.1" max="0.9" step="0.1" placeholder="0.7">
                        </div>
                        <div>
                            <label class="form-label">验证集比例</label>
                            <input type="number" class="form-control" id="valRatio" value="0.2" min="0.1" max="0.9" step="0.1" placeholder="0.2">
                        </div>
                        <div>
                            <label class="form-label">测试集比例</label>
                            <input type="number" class="form-control" id="testRatio" value="0.1" min="0.0" max="0.9" step="0.1" placeholder="0.1">
                        </div>
                    </div>
                    <div class="help-text">三个比例之和应该等于1.0，系统会自动调整</div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">训练轮数</label>
                        <input type="number" class="form-control" id="epochs" value="100" min="1" max="1000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">批次大小</label>
                        <input type="number" class="form-control" id="batchSize" value="16" min="1" max="128">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">学习率</label>
                        <input type="number" class="form-control" id="learningRate" value="0.01" min="0.0001" max="1" step="0.0001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">图像尺寸</label>
                        <input type="number" class="form-control" id="imageSize" value="640" min="320" max="1280" step="32">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">计算设备</label>
                        <select class="form-control" id="device">
                            {% for device in available_devices %}
                            <option value="{{ device.name }}">{{ device.description }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">优化器</label>
                        <select class="form-control" id="optimizer">
                            <option value="auto">自动选择</option>
                            <option value="SGD">SGD</option>
                            <option value="Adam">Adam</option>
                            <option value="AdamW">AdamW</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">保存配置</label>
                    <input type="text" class="form-control" id="configName" placeholder="可选：为此配置起个名称以便重复使用">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary btn-large" onclick="closeCreateTaskModal()">取消</button>
            <button type="button" class="btn btn-primary btn-large" onclick="createTask()">创建任务</button>
        </div>
    </div>
</div>

<!-- 任务详情模态框 -->
<div id="taskDetailsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">训练任务详情</div>
            <button class="close-btn" onclick="closeTaskDetailsModal()">&times;</button>
        </div>
        <div class="modal-body" id="taskDetailsContent">
            <!-- 动态加载内容 -->
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/training.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // 传递项目名称到JavaScript
    window.projectName = '{{ project_name }}';
    
    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
        // 定期更新任务状态
        if (typeof updateTaskStatuses === 'function') {
            setInterval(updateTaskStatuses, 5000);
        }
    });
</script>
{% endblock %}