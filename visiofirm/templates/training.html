{% extends "labeler_base.html" %}
{% block title %}{{ project_name }} - 模型训练{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/training.css') }}">
{% endblock %}

{% block content %}
<!-- 模板数据传递 -->
<div id="template-data" 
     style="display: none;" 
     data-project-name="{{ project_name | default('') | e }}" 
     data-is-authenticated="{{ current_user.is_authenticated | string | lower }}"></div>

<div class="training-dashboard">
    <!-- Header -->
    <div class="dashboard-header">
        <div class="project-info">
            <h1 class="project-title">{{ project_name }} - 模型训练</h1>
            <p class="project-subtitle">训练您的自定义模型</p>
        </div>
        <div class="dashboard-actions">
            <a href="/" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i>
                返回仪表板
            </a>
            <button class="btn btn-primary" id="startTrainingBtn">
                <i class="fas fa-play"></i>
                开始训练
            </button>
            <button class="btn btn-danger" id="stopTrainingBtn" style="display: none;">
                <i class="fas fa-stop"></i>
                停止训练
            </button>
        </div>
    </div>
    
    <!-- Training Grid -->
    <div class="training-grid">
        <!-- Training Configuration -->
        <div class="training-card">
            <div class="card-header">
                <h3 class="card-title">训练配置</h3>
                <p class="card-subtitle">设置训练参数</p>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label class="form-label" for="modelType">模型类型</label>
                    <select class="form-select" id="modelType">
                        <option value="yolov8n">YOLOv8 Nano (最快)</option>
                        <option value="yolov8s">YOLOv8 Small (平衡)</option>
                        <option value="yolov8m">YOLOv8 Medium (高精度)</option>
                        <option value="yolov8l">YOLOv8 Large (更高精度)</option>
                        <option value="yolov8x">YOLOv8 Extra Large (最高精度)</option>
                        <option value="yolov10n">YOLOv10 Nano (最新)</option>
                        <option value="yolov10s">YOLOv10 Small (最新平衡)</option>
                        <option value="yolov10m">YOLOv10 Medium (最新高精度)</option>
                        <option value="yolov10l">YOLOv10 Large (最新更高精度)</option>
                        <option value="yolov10x">YOLOv10 Extra Large (最新最高精度)</option>
                    </select>
                    <div class="model-info" id="modelInfo">
                        <small class="text-muted">选择模型后会自动检查并下载（如需要）</small>
                    </div>
                </div>
                
                <div class="training-controls">
                    <div class="control-group">
                        <label class="control-label">训练轮数</label>
                        <input type="number" class="control-input" id="epochs" value="10" min="1" max="1000">
                    </div>
                    <div class="control-group">
                        <label class="control-label">批次大小</label>
                        <input type="number" class="control-input" id="batchSize" value="32" min="1" max="128">
                    </div>
                    <div class="control-group">
                        <label class="control-label">学习率</label>
                        <input type="number" class="control-input" id="learningRate" value="0.001" step="0.0001" min="0.0001" max="1">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="datasetPath">数据集路径</label>
                    <input type="text" class="form-input" id="datasetPath" placeholder="选择数据集路径">
                </div>
            </div>
        </div>
        
        <!-- Training Status -->
        <div class="training-card">
            <div class="card-header">
                <h3 class="card-title">训练状态</h3>
                <p class="card-subtitle">实时监控训练进度</p>
            </div>
            <div class="card-body">
                <div class="training-status">
                    <div class="status-indicator status-idle"></div>
                    <div class="status-text">准备开始训练</div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">等待开始训练</div>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>
                
                <div class="training-metrics">
                    <div class="metric-card accuracy">
                        <div class="metric-value" data-metric="accuracy">0%</div>
                        <div class="metric-label">准确率</div>
                    </div>
                    <div class="metric-card loss">
                        <div class="metric-value" data-metric="loss">0.00</div>
                        <div class="metric-label">损失值</div>
                    </div>
                    <div class="metric-card epoch">
                        <div class="metric-value" data-metric="epoch">0</div>
                        <div class="metric-label">当前轮数</div>
                    </div>
                </div>
                
                <div class="training-log">
                    <div class="log-entry">
                        <span class="log-timestamp">等待开始...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/training.js') }}"></script>
{% endblock %}
