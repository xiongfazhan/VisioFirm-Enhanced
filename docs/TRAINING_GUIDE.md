# VisioFirm 训练模块用户指南

## 概述

VisioFirm 训练模块为您提供了完整的深度学习模型训练能力，支持从标注数据到训练完成的端到端工作流。本指南将帮助您快速上手并充分利用训练模块的各项功能。

## 目录

1. [快速开始](#快速开始)
2. [功能详解](#功能详解)
3. [性能优化](#性能优化)
4. [常见问题](#常见问题)
5. [错误排查](#错误排查)
6. [最佳实践](#最佳实践)

## 快速开始

### 前提条件

在使用训练模块之前，请确保：

1. **已完成图像标注**：项目中至少有一张已标注的图像
2. **系统要求**：
   - Python 3.10+
   - 8GB+ 内存（推荐 16GB+）
   - GPU（可选，但强烈推荐用于加速训练）
3. **依赖安装**：确保已安装 ultralytics 框架

### 第一个训练任务

1. **进入训练页面**
   ```
   导航到：项目 → 训练模块
   ```

2. **创建训练任务**
   - 点击"创建训练任务"按钮
   - 填写任务基本信息：
     - 任务名称：为任务起一个有意义的名称
     - 模型类型：选择适合您需求的YOLO模型
   - 配置数据集分割：
     - 训练集：70%（默认）
     - 验证集：20%（默认）  
     - 测试集：10%（默认）

3. **设置训练参数**
   - 训练轮数：100（默认，可根据数据量调整）
   - 批次大小：16（默认，根据GPU内存调整）
   - 学习率：0.01（默认）
   - 图像尺寸：640（默认）

4. **启动训练**
   - 点击"创建任务"
   - 在任务列表中点击"开始训练"

## 功能详解

### 模型选择指南

| 模型 | 特点 | 适用场景 | 训练时间 | 精度 |
|------|------|----------|----------|------|
| YOLOv8n | 最快，最小 | 快速原型，资源受限 | 最短 | 较低 |
| YOLOv8s | 平衡速度和精度 | 通用项目，推荐新手 | 短 | 中等 |
| YOLOv8m | 较高精度 | 精度要求较高的项目 | 中等 | 较高 |
| YOLOv8l | 高精度 | 生产环境，高精度需求 | 较长 | 高 |
| YOLOv8x | 最高精度 | 研究项目，最高精度需求 | 最长 | 最高 |

### 数据集配置

#### 分割比例建议
- **小数据集（<100张）**：训练集80%，验证集20%，测试集0%
- **中等数据集（100-1000张）**：训练集70%，验证集20%，测试集10%
- **大数据集（>1000张）**：训练集70%，验证集15%，测试集15%

#### 数据质量要求
- 每个类别至少有10张标注图像
- 标注框应准确覆盖目标对象
- 避免重复或过于相似的图像

### 训练参数优化

#### 训练轮数（Epochs）
- **小数据集**：50-100轮
- **中等数据集**：100-200轮
- **大数据集**：200-500轮

#### 批次大小（Batch Size）
根据GPU内存选择：
- **4GB GPU**：批次大小 4-8
- **8GB GPU**：批次大小 8-16
- **16GB+ GPU**：批次大小 16-32

#### 学习率（Learning Rate）
- **默认值**：0.01（适合大多数情况）
- **大数据集**：可适当降低到 0.005
- **小数据集**：可适当提高到 0.02

### 训练监控

#### 实时进度查看
- **进度条**：显示当前训练进度百分比
- **损失曲线**：实时显示训练损失变化
- **当前轮数**：显示当前训练轮数/总轮数
- **预计剩余时间**：基于当前进度估算完成时间

#### 性能指标
训练完成后可查看以下指标：
- **mAP50**：IoU=0.5时的平均精度
- **mAP50-95**：IoU从0.5到0.95的平均精度
- **Precision**：精确率
- **Recall**：召回率
- **F1-Score**：F1分数

## 性能优化

### 系统资源监控

训练页面提供实时系统资源监控：

#### CPU 和内存监控
- **CPU使用率**：显示当前CPU利用率
- **内存使用率**：显示系统内存使用情况
- **可用内存**：显示剩余可用内存
- **活跃任务数**：显示当前运行的训练任务数

#### GPU 监控（如果可用）
- **GPU利用率**：显示GPU使用情况
- **显存使用率**：显示GPU内存使用情况
- **设备信息**：显示GPU型号和容量

### 自动优化建议

系统会根据当前资源使用情况提供优化建议：

#### 内存优化
- 当内存使用率超过85%时，建议减少批次大小
- 关闭图像缓存以节省内存
- 减少数据加载线程数

#### GPU优化
- 当GPU内存使用率过高时，建议启用梯度累积
- 调整批次大小以适应GPU内存

#### 并发控制
- 系统自动限制并发训练任务数
- 根据可用资源智能分配计算资源

### 一键优化配置

点击"优化配置"按钮获取针对当前硬件环境的最优配置：

```json
{
    "epochs": 100,
    "batch": 16,
    "lr0": 0.01,
    "device": "auto",
    "amp": true,
    "cache": false,
    "workers": 4
}
```

## 常见问题

### Q1: 训练任务创建失败，提示"没有已标注的图片"
**解决方案：**
1. 确保项目中至少有一张完成标注的图像
2. 检查标注数据是否正确保存
3. 重新进行图像标注并保存

### Q2: 训练速度很慢
**可能原因和解决方案：**
1. **使用CPU训练**：安装CUDA并使用GPU加速
2. **批次大小过小**：适当增加批次大小
3. **数据加载瓶颈**：增加数据加载线程数
4. **图像尺寸过大**：减小图像尺寸到640或更小

### Q3: 训练过程中出现内存不足错误
**解决方案：**
1. 减少批次大小（例如从16减到8）
2. 关闭图像缓存
3. 减少数据加载线程数
4. 使用更小的模型（如从YOLOv8l改为YOLOv8s）

### Q4: 训练精度不理想
**改进建议：**
1. **增加训练数据**：收集更多标注数据
2. **提高数据质量**：检查并修正标注错误
3. **调整超参数**：尝试不同的学习率和训练轮数
4. **使用更大的模型**：升级到精度更高的模型

### Q5: 训练中断或失败
**排查步骤：**
1. 查看错误日志获取详细信息
2. 检查磁盘空间是否充足
3. 确认系统资源是否充足
4. 重启训练任务

## 错误排查

### 常见错误信息

#### 错误：`No module named 'ultralytics'`
**解决方案：**
```bash
pip install ultralytics
```

#### 错误：`CUDA out of memory`
**解决方案：**
1. 减少批次大小
2. 使用更小的模型
3. 启用混合精度训练

#### 错误：`数据集分割比例之和应为1.0`
**解决方案：**
确保训练集、验证集、测试集比例之和等于1.0

#### 错误：`训练数据集太小`
**解决方案：**
增加标注数据，确保每个类别至少有足够的样本

### 日志查看

在浏览器开发者工具的控制台中可以查看详细的训练日志：

1. 按F12打开开发者工具
2. 切换到"Console"标签页
3. 查看训练过程中的详细信息和错误提示

### 性能分析

#### 训练速度分析
- **GPU利用率低**：可能是数据加载瓶颈，增加workers数量
- **内存使用率高**：减少batch_size或关闭cache
- **CPU使用率高**：减少数据预处理复杂度

#### 收敛性分析
- **损失不下降**：学习率可能过高或过低
- **过拟合**：减少训练轮数或增加数据增强
- **欠拟合**：增加模型复杂度或训练轮数

## 最佳实践

### 数据准备
1. **数据质量优先**：高质量的少量数据胜过低质量的大量数据
2. **类别平衡**：确保各类别样本数量相对均衡
3. **多样化数据**：包含不同光照、角度、背景的图像

### 训练策略
1. **从小模型开始**：先用YOLOv8n快速验证，再升级到大模型
2. **渐进式训练**：先用少量轮数快速验证，再进行完整训练
3. **早停机制**：启用早停避免过拟合

### 资源管理
1. **监控资源使用**：定期查看资源监控面板
2. **合理安排训练时间**：在系统负载较低时进行训练
3. **并发控制**：避免同时运行过多训练任务

### 模型评估
1. **多指标评估**：不要只看单一指标，综合评估模型性能
2. **验证集评估**：定期在验证集上评估模型性能
3. **可视化结果**：查看预测结果可视化图像

### 部署考虑
1. **模型格式**：根据部署环境选择合适的导出格式
2. **性能测试**：在目标环境上测试模型性能
3. **版本管理**：保存和管理不同版本的训练模型

## 技术支持

如果您在使用过程中遇到问题：

1. **查看本文档**：首先查阅相关章节
2. **检查日志**：查看浏览器控制台和训练日志
3. **系统要求**：确认系统满足最低配置要求
4. **社区支持**：访问项目GitHub页面获取帮助

---

*最后更新：2024年9月*